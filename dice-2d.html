<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>2D„Çµ„Ç§„Ç≥„É≠„Ç∑„Éü„É•„É¨„Éº„Çø„Éº</title>
<style>
  :root {
    --size: 90px;
    --pip: 12px;
    --gap: 14px;
  }
  body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
    margin: 0;
    padding: 24px;
    background: #f0f2f5;
    color: #111;
  }
  .container {
    max-width: 960px;
    margin: 0 auto;
  }
  header {
    background: white;
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,.08);
  }
  h1 {
    margin: 0 0 12px;
    font-size: 28px;
    font-weight: 700;
  }
  .lead {
    margin: 0;
    color: #4b5563;
    font-size: 15px;
  }
  .config-panel {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
  }
  .config-group {
    background: #f8f9fa;
    padding: 18px;
    border-radius: 10px;
    border: 1px solid #e0e0e0;
  }
  .config-group h3 {
    margin: 0 0 12px;
    font-size: 14px;
    font-weight: 700;
    color: #4b5563;
    letter-spacing: .4px;
  }
  .number-input,
  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }
  .number-input label {
    min-width: 80px;
    font-size: 14px;
  }
  .number-input input {
    flex: 1;
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #d1d5db;
    font-size: 14px;
  }
  .checkbox-item label {
    font-size: 14px;
    cursor: pointer;
  }
  .checkbox-item input {
    cursor: pointer;
  }
  .actions {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-top: 16px;
  }
  button {
    padding: 12px 24px;
    font-size: 15px;
    font-weight: 600;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    transition: all .15s;
  }
  .btn-primary {
    background: #2563eb;
    color: white;
  }
  .btn-primary:hover {
    background: #1d4ed8;
  }
  .btn-primary:disabled {
    background: #94a3b8;
    cursor: not-allowed;
  }
  .btn-secondary {
    background: #64748b;
    color: white;
  }
  .btn-secondary:hover {
    background: #475569;
  }
  .dice-container {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,.08);
    min-height: 200px;
  }
  .board-2d {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--size), 1fr));
    gap: var(--gap);
    justify-items: center;
  }
  .die-2d {
    width: var(--size);
    height: var(--size);
    background: #fff;
    border-radius: 16px;
    border: 1px solid #d0d4da;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    padding: 10px;
    box-shadow: 0 6px 18px rgba(0,0,0,.12);
  }
  .rolling-2d {
    animation: shake2d 0.5s ease;
  }
  @keyframes shake2d {
    0%, 100% { transform: rotate(0) translate(0, 0); }
    25% { transform: rotate(6deg) translate(2px, -1px); }
    50% { transform: rotate(-5deg) translate(-2px, 1px); }
    75% { transform: rotate(3deg) translate(1px, 2px); }
  }
  .pip {
    width: var(--pip);
    height: var(--pip);
    background: #111;
    border-radius: 50%;
    margin: auto;
  }
  .p1 { grid-area: 1 / 1; }
  .p2 { grid-area: 1 / 2; }
  .p3 { grid-area: 1 / 3; }
  .p4 { grid-area: 2 / 1; }
  .p5 { grid-area: 2 / 2; }
  .p6 { grid-area: 2 / 3; }
  .p7 { grid-area: 3 / 1; }
  .p8 { grid-area: 3 / 2; }
  .p9 { grid-area: 3 / 3; }
  .results {
    margin-top: 20px;
    padding: 16px;
    background: #ecfdf5;
    border-radius: 10px;
    border: 1px solid #a7f3d0;
    color: #065f46;
    font-size: 15px;
    display: none;
  }
  .results-detail {
    margin-top: 4px;
    font-size: 14px;
    color: #047857;
  }
  .debug-controls {
    margin-top: 12px;
    padding: 12px;
    background: #fff3cd;
    border-radius: 6px;
    border: 1px solid #ffc107;
    display: none;
  }
  .debug-controls label {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 8px;
    display: block;
  }
  .debug-inputs {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .debug-inputs input {
    width: 50px;
    padding: 4px 8px;
    border: 1px solid #d0d0d0;
    border-radius: 4px;
    text-align: center;
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üé≤ 2D„Çµ„Ç§„Ç≥„É≠„Ç∑„Éü„É•„É¨„Éº„Çø„Éº</h1>
      <p class="lead">„Éï„É©„ÉÉ„Éà„Å™2DÊèèÁîª„Å´„Çà„ÇãËªΩÈáè„Å™„Çµ„Ç§„Ç≥„É≠Ë°®Á§∫„Åß„Åô„ÄÇ</p>
    </header>

    <section class="config-panel">
      <div class="config-group">
        <h3>Âü∫Êú¨Ë®≠ÂÆö</h3>
        <div class="number-input">
          <label for="diceCount">ÂÄãÊï∞:</label>
          <input type="number" id="diceCount" min="1" max="12" value="3">
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="debugMode">
          <label for="debugMode">„Éá„Éê„ÉÉ„Ç∞„É¢„Éº„Éâ</label>
        </div>
      </div>
      <div class="config-group debug-controls" id="debugControls">
        <h3>„Éá„Éê„ÉÉ„Ç∞Ë®≠ÂÆö</h3>
        <label for="debugValues">Âá∫ÁõÆ („Ç´„É≥„ÉûÂå∫Âàá„Çä„ÄÅ1-6)</label>
        <div class="debug-inputs">
          <input type="text" id="debugValues" placeholder="‰æã: 1,2,3">
        </div>
      </div>
    </section>

    <section class="dice-container">
      <div id="diceBoard" class="board-2d"></div>
      <div class="actions">
        <button id="rollBtn" class="btn-primary">„É≠„Éº„É´„Åô„Çã (Space)</button>
        <button id="resetBtn" class="btn-secondary">„É™„Çª„ÉÉ„Éà</button>
      </div>
      <div id="results" class="results"></div>
    </section>
  </div>

<script>
(() => {
  const diceBoard = document.getElementById('diceBoard');
  const resultsEl = document.getElementById('results');
  const rollBtn = document.getElementById('rollBtn');
  const resetBtn = document.getElementById('resetBtn');
  const diceCountInput = document.getElementById('diceCount');
  const debugModeCheck = document.getElementById('debugMode');
  const debugControls = document.getElementById('debugControls');
  const debugValuesInput = document.getElementById('debugValues');

  const state = {
    diceCount: Number(diceCountInput.value) || 3,
    diceElements: [],
    isRolling: false,
    debugMode: false
  };

  function randint1n(n) {
    if (crypto?.getRandomValues) {
      const max = 0xFFFFFFFF;
      const limit = Math.floor(max / n) * n;
      const buf = new Uint32Array(1);
      for (;;) {
        crypto.getRandomValues(buf);
        if (buf[0] < limit) return (buf[0] % n) + 1;
      }
    }
    return Math.floor(Math.random() * n) + 1;
  }

  function getPipPositions(value) {
    const map = {
      1: [5],
      2: [1, 9],
      3: [1, 5, 9],
      4: [1, 3, 7, 9],
      5: [1, 3, 5, 7, 9],
      6: [1, 3, 4, 6, 7, 9]
    };
    return map[value] || [5];
  }

  function createDie2D(value) {
    const die = document.createElement('div');
    die.className = 'die-2d';
    updateDieFace(die, value);
    return die;
  }

  function updateDieFace(die, value) {
    die.innerHTML = '';
    const pips = getPipPositions(value);
    for (const pos of pips) {
      const pip = document.createElement('div');
      pip.className = `pip p${pos}`;
      die.appendChild(pip);
    }
    die.setAttribute('data-value', value);
  }

  function initBoard() {
    diceBoard.innerHTML = '';
    state.diceElements = [];
    resultsEl.style.display = 'none';

    for (let i = 0; i < state.diceCount; i++) {
      const die = createDie2D(randint1n(6));
      diceBoard.appendChild(die);
      state.diceElements.push(die);
    }
  }

  function getTargetValues() {
    if (state.debugMode) {
      const input = debugValuesInput.value.trim();
      if (input) {
        const parsed = input.split(',').map(v => {
          const n = parseInt(v.trim(), 10);
          return (n >= 1 && n <= 6) ? n : randint1n(6);
        });
        while (parsed.length < state.diceCount) {
          parsed.push(randint1n(6));
        }
        return parsed.slice(0, state.diceCount);
      }
    }
    return Array.from({ length: state.diceCount }, () => randint1n(6));
  }

  function showResults(values, total) {
    resultsEl.style.display = 'block';
    resultsEl.innerHTML = `
      <div>ÂêàË®à: <strong>${total}</strong></div>
      <div class="results-detail">Âá∫ÁõÆ: ${values.join(', ')}</div>
    `;
  }

  function roll2D() {
    if (state.isRolling) return;
    state.isRolling = true;
    rollBtn.disabled = true;

    const dice = state.diceElements;
    const values = getTargetValues();

    dice.forEach(die => die.classList.add('rolling-2d'));

    setTimeout(() => {
      let total = 0;
      dice.forEach((die, index) => {
        const value = values[index];
        total += value;
        updateDieFace(die, value);
        die.classList.remove('rolling-2d');
      });
      showResults(values, total);
      state.isRolling = false;
      rollBtn.disabled = false;
    }, 400);
  }

  rollBtn.addEventListener('click', roll2D);
  resetBtn.addEventListener('click', () => {
    state.isRolling = false;
    rollBtn.disabled = false;
    initBoard();
  });

  diceCountInput.addEventListener('change', (e) => {
    const next = Math.max(1, Math.min(12, parseInt(e.target.value, 10) || 1));
    state.diceCount = next;
    diceCountInput.value = next;
    initBoard();
  });

  debugModeCheck.addEventListener('change', (e) => {
    state.debugMode = e.target.checked;
    debugControls.style.display = state.debugMode ? 'block' : 'none';
  });

  document.addEventListener('keydown', (e) => {
    if (e.code === 'Space') {
      e.preventDefault();
      roll2D();
    }
  });

  initBoard();
})();
</script>
</body>
</html>
